### MANUAL_DE_RODAGEM ‚Äî execu√ß√£o local passo a passo completo (PROJETOS: aps_1 backend e qualidade_ar_app frontend)

Resumo r√°pido: manual completo para o avaliador instalar, configurar e executar localmente o backend Python (projeto aps_1 ‚Äî estrutura mostrada na imagem do PyCharm) e o app Flutter Android (workspace qualidade_ar_app ‚Äî estrutura mostrada na imagem do VSCode). **A execu√ß√£o do frontend √© garantida apenas no Android Emulator** devido √† configura√ß√£o de rede para acesso ao backend local. Instru√ß√µes sobre notifica√ß√µes foram removidas. O backend usa a porta 5000. **O uso de Docker para o backend √© obrigat√≥rio.** Arquivo final sugerido: MANUAL_DE_RODAGEM.txt (encoding UTF-8).

---

### 1. Pr√©-requisitos do sistema (instalar antes de come√ßar)
- SO suportados: Windows 10/11, macOS, Linux com suporte a Android Emulator.  
- **Docker Desktop instalado e em execu√ß√£o (Obrigat√≥rio).**  
- VSCode + extens√£o Flutter (Dart & Flutter).  
- Android Studio (SDK, AVD Manager, Android Emulator).  
- Android SDK: Platform 33 (ou >= targetSdk), Platform Tools, Build-Tools compat√≠vel.  
- JDK 17 instalado; configurar JAVA_HOME apontando para ele.  
- Flutter SDK compat√≠vel com a vers√£o do projeto.  
- Python 3.9+ instalado (necess√°rio para o Docker build).  
- Git (para clonar reposit√≥rio).  
- Conex√£o com a internet.

Observa√ß√£o: n√£o commitar chaves sens√≠veis. Mant√™-las localmente (ex.: arquivos JSON, Google keys, .env).

---

### 2. Estrutura dos projetos (conforme imagens fornecidas)
- Backend (PyCharm) ‚Äî projeto aps_1 (ex.: C:\Users\soler\PycharmProjects\aps_1)
  - .venv (virtualenv)
  - routes/ (air_quality.py, alerts.py, enderecos.py, usuarios.py)
  - services/ (external_api.py, notifications.py, arquivo JSON de credenciais)
  - app.py (entrada principal)
  - dockerfile, .dockerignore
  - models.py, requirements.txt
- Frontend (VSCode) ‚Äî workspace qualidade_ar_app
  - android/, ios/, lib/, build/, test/, pubspec.yaml, firebase.json, etc.

Use essas estruturas para localizar arquivos, Dockerfile e caminhos de build.

---

### 3. Arquivos e configura√ß√µes locais obrigat√≥rios
- Arquivos sens√≠veis (ex.: credenciais JSON, google-services.json) devem ser colocados localmente nos diret√≥rios corretos e nunca versionados.  
- Criar .env no backend com vari√°veis necess√°rias (exemplo abaixo). Nunca commitar .env.

Exemplo m√≠nimo .env:
FLASK_ENV=development
PORT=5000
DATABASE_URL=sqlite:///data.db

---

### 4. Configura√ß√£o do Android Studio e Emulador (Obrigat√≥rio)

**1. Instalar SDKs e JDK**
- Abra Android Studio ‚Üí Configure ‚Üí SDK Manager. ou Abra Android Studio ‚ÜíMore actions ‚Üí SDK Manager. 
- Em **SDK Platforms**, marque a API Level que seu projeto usa e instale.  
- Em **SDK Tools**, marque **Android SDK Platform-Tools** e **Android SDK Build-Tools**; aplique.  
- Em File ‚Üí Settings ‚Üí Build, Execution, Deployment ‚Üí Build Tools verifique o JDK (recomendo JDK 11).  

**2. Acessar SDK Manager a partir de More Actions**
- Na tela de boas-vindas do Android Studio, clique em **More Actions** ‚Üí **SDK Manager**.  
- Confirme e instale componentes necess√°rios (Platform SDK, Platform-Tools, Build-Tools).  

**3. Configurar vari√°veis de ambiente (opcional mas recomendado)**
- No sistema defina `ANDROID_SDK_ROOT` (ou `ANDROID_HOME`) apontando para a pasta SDK (ex.: `C:\Users\<you>\AppData\Local\Android\Sdk`).  
- Defina `JAVA_HOME` para o diret√≥rio do JDK instalado.  
- Reinicie o Android Studio se alterou vari√°veis.

**4. Criar AVD (emulador)**
- Menu inicial ‚Üí More Actions -- AVD Manager ‚Üí Create Virtual Device. ou Tools ‚Üí AVD Manager ‚Üí Create Virtual Device. 
- Escolha um dispositivo (ex.: Pixel 4).  
- Ao escolher System Image selecione uma imagem com **Google Play** (importante para FCM) e baixe se necess√°rio.  
- Configure as op√ß√µes (RAM/ABI) e finalizar a cria√ß√£o.

**5. Ajustes do AVD recomendados**
- Em Advanced Settings do AVD, mantenha **Device frame** e **Graphics** em Automatic; se tiver problemas de performance, troque para Software.  
- Confirme que a ABI √© compat√≠vel com seu build (x86_64 para imagens de emulador com acelera√ß√£o).

**6. Iniciar o emulador**
- No AVD Manager, clique em Play (‚ñ∫) ao lado do AVD criado para inicializ√°-lo.  
- Aguarde o boot completo (pode demorar na primeira vez). Verifique que a Play Store/Google Play Services estejam presentes se a image tiver Google Play.

**7. Verificar disponibilidade para o Flutter**
- No terminal do projeto Flutter rode:
  ```bash
  flutter devices
  ```
  para confirmar que o emulador aparece como dispositivo conectado.  
- Rode:
  ```bash
  flutter doctor
  ```
  e corrija quaisquer alertas relativos ao Android toolchain.

---

### 5. Backend (aps_1) ‚Äî abrir no PyCharm e execu√ß√£o com Docker (Obrigat√≥rio)

1. Abra o projeto aps_1 no PyCharm (confirme a estrutura: app.py, routes/, services/, requirements.txt).  
2. **Execu√ß√£o via Docker (Obrigat√≥rio):**
   - No diret√≥rio que cont√©m o Dockerfile:
     ```bash
     docker build -t air-quality-api .
     ```
   - Rodar o container mapeando porta 5000:
     ```bash
     docker run --rm -p 5000:5000 air-quality-api
     ```
   - Ver logs do container (se necess√°rio):
     ```bash
     docker logs -f <container-id>
     ```
   - Testar endpoint:
     Abra `http://localhost:5000/health` (ou rota definida).

Observa√ß√£o: backend deve escutar na porta 5000 para que o app mobile se conecte. Confirme o mapeamento `-p 5000:5000`.

---

### 6. Frontend (qualidade_ar_app) ‚Äî abrir no VSCode e executar

1. **Certifique-se de que o Android Emulator est√° iniciado (conforme Se√ß√£o 4).**
2. Abra o workspace qualidade_ar_app no VSCode com a extens√£o Flutter ativa.  
3. No terminal do VSCode (raiz do projeto) execute:
   ```bash
   flutter clean
   flutter pub get
   ```
4. Verifique dispositivo/emulador:
   ```bash
   flutter devices
   ```
   ou
   ```bash
   adb devices
   ```
5. Rodar em modo desenvolvimento:
   ```bash
   flutter run
   ```

Fallback se `flutter run` falhar:
- No diret√≥rio android (Windows):
  ```bash
  cd android
  .\gradlew.bat clean assembleRelease
  ```
- Em seguida, instalar o APK release (volte ao caminho apropriado se necess√°rio):
  ```bash
  adb install -r app\build\outputs\apk\release\app-release.apk
  ```

Observa√ß√µes:
- Se ocorrer erro de Gradle relacionado ao JDK, edite `android/gradle.properties` e adicione:
  ```
  org.gradle.java.home=C:\\Program Files\\Java\\jdk-17.0.x
  ```
  (use o caminho real do JDK 17 instalado)
- Ajuste paths se seu projeto estiver em local diferente.

---

### 7. Sequ√™ncia recomendada de abertura e execu√ß√£o (ordem precisa)

1. Instalar pr√©-requisitos (Docker, Android Studio, VSCode + Flutter, JDK 17, Python).  
2. **Configurar o Android Studio e iniciar o Android Emulator (Se√ß√£o 4).**
3. Abrir projeto backend **aps_1** no PyCharm.  
4. Abrir Docker Desktop e, na pasta do backend, executar:
   ```bash
   docker build -t air-quality-api .
   docker run --rm -p 5000:5000 air-quality-api
   ```
5. Abrir workspace **qualidade_ar_app** no VSCode (extens√£o Flutter).  
6. No terminal do VSCode (raiz do frontend):
   ```bash
   flutter clean
   flutter pub get
   ```
7. No terminal do VSCode rodar:
   ```bash
   flutter run
   ```
   Se n√£o funcionar, seguir o fallback do item 6 para gerar e instalar o APK release.  
8. Ver logs com `flutter logs` e `adb logcat` para diagnosticar erros.  
9. Se necess√°rio, remover APKs gerados (ver se√ß√£o 8).  
10. Para qualquer falha, coletar trechos do log com mensagens de erro (‚ÄúCaused by‚Äù, ‚ÄúException‚Äù, stacktrace) e enviar ao autor do projeto.

---

### 8. Comandos √∫teis de verifica√ß√£o e troubleshooting

- Ver dispositivos conectados:
  ```bash
  adb devices
  ```

- Logs Flutter:
  ```bash
  flutter logs
  ```

- Logs do Android (filtrar por termos relevantes):
  ```bash
  adb logcat
  ```

- For√ßar refresh de depend√™ncias Gradle:
  ```bash
  cd android
  .\gradlew.bat --refresh-dependencies
  ```

- Build com logs detalhados:
  ```bash
  cd android
  .\gradlew.bat assembleDebug --stacktrace --info
  ```

- Se encontrar erro de desugaring (desugar_jdk_libs), confirme em `android/app/build.gradle(.kts)` as op√ß√µes de `compileOptions` e depend√™ncia `coreLibraryDesugaring`.

---

### 9. Remover APKs gerados (scripts de exemplo para adaptar ao caminho do avaliador)

Substitua `CAMINHO_PROJ` pelo caminho absoluto do projeto no PC.

- Windows PowerShell:
  ```powershell
  Remove-Item -Path "C:\CAMINHO_PROJ\android\app\build\outputs\apk\debug\app-debug.apk" -Force -ErrorAction SilentlyContinue
  Remove-Item -Path "C:\CAMINHO_PROJ\android\app\build\outputs\apk\release\app-release.apk" -Force -ErrorAction SilentlyContinue
  Get-ChildItem -Path "C:\CAMINHO_PROJ\android\app\build\outputs\apk" -Recurse -Filter *.apk | Remove-Item -Force -ErrorAction SilentlyContinue
  ```

- macOS / Linux (bash):
  ```bash
  rm -f "/home/usuario/CAMINHO_PROJ/android/app/build/outputs/apk/debug/app-debug.apk"
  rm -f "/home/usuario/CAMINHO_PROJ/android/app/build/outputs/apk/release/app-release.apk"
  find "/home/usuario/CAMINHO_PROJ/android/app/build/outputs/apk" -name "*.apk" -type f -delete
  ```

Use esses comandos com cuidado ‚Äî eles removem arquivos permanentemente.

---

### 10. Observa√ß√µes finais e dicas r√°pidas\n\n- **Aten√ß√£o:** O projeto, por padr√£o, est√° configurado para rodar apenas no **Android Emulator** devido ao uso do endere√ßo `10.0.2.2:5000` para acessar o backend local. Para rodar em um celular f√≠sico, siga as instru√ß√µes da **Se√ß√£o 11** abaixo.

- Confirme que o backend (Docker) est√° acess√≠vel em `http://localhost:5000` antes de abrir o app.  
- Se o app falhar ao se comunicar com o backend, verifique CORS, endpoints e URLs configuradas no Flutter. **A execu√ß√£o √© garantida apenas no Android Emulator** porque o endere√ßo `10.0.2.2:5000` √© o IP especial que o emulador usa para acessar o `localhost:5000` da m√°quina hospedeira. Em um dispositivo f√≠sico, seria necess√°rio configurar o app para usar o IP de rede local da m√°quina hospedeira (ex: `http://192.168.x.x:5000`) e garantir que o firewall da m√°quina hospedeira permita a conex√£o, o que √© um cen√°rio mais complexo e n√£o coberto por este manual. **Portanto, use o Android Emulator.**  
- Ajuste `applicationId`/`namespace` no `android/app/build.gradle(.kts)` conforme arquivos locais (ex.: `google-services.json`) se aplic√°vel.  
- Mantenha credenciais fora do reposit√≥rio e documente localmente onde cada arquivo sens√≠vel deve ficar.

---

### 11. üì± Rodagem do APK em Celular F√≠sico via IP Local (Opcional)

Esta se√ß√£o detalha como configurar o ambiente para que o aplicativo (ap√≥s a compila√ß√£o do APK) possa se comunicar com o backend em Docker, rodando na sua m√°quina, a partir de um celular f√≠sico. **√â crucial que o PC e o celular estejam na mesma rede Wi-Fi.**

#### Passo 1 ‚Äî Descobrir o IP do PC
- No **Windows**, abra o Prompt de Comando e digite:
  ```
  ipconfig
  ```
  Procure pelo campo **Endere√ßo IPv4** (ex.: `192.168.1.42`).
- No **Linux/Mac**, use:
  ```
  ifconfig
  ```
  ou
  ```
  ip a
  ```
  Procure pelo IP da interface de rede (ex.: `192.168.0.15`).

#### Passo 2 ‚Äî Configurar o backend para aceitar conex√µes externas
O Docker, por padr√£o, j√° mapeia a porta 5000 para `0.0.0.0` na m√°quina hospedeira, o que permite conex√µes externas. **N√£o √© necess√°rio alterar o c√≥digo do backend**, mas certifique-se de que o comando de execu√ß√£o do Docker foi:
```bash
docker run --rm -p 5000:5000 air-quality-api
```

#### Passo 3 ‚Äî Liberar a porta no firewall
- **Windows**: abra ‚ÄúFirewall do Windows com Seguran√ßa Avan√ßada‚Äù ‚Üí Regras de Entrada ‚Üí Nova Regra ‚Üí Porta ‚Üí TCP 5000 ‚Üí Permitir.
- **Linux/Mac**: se usar `ufw`, rode:
  ```bash
  sudo ufw allow 5000
  ```

#### Passo 4 ‚Äî Alterar a URL no app Flutter
No c√≥digo Flutter, substitua o endere√ßo do backend (que aponta para o emulador):
```dart
const backendBaseUrl = "http://10.0.2.2:5000";
```
por:
```dart
const backendBaseUrl = "http://192.168.1.42:5000";
```
(use o IP real do seu PC, descoberto no Passo 1).

#### Passo 5 ‚Äî Conectar celular e PC na mesma rede
- O celular f√≠sico precisa estar conectado √† **mesma rede Wi‚ÄëFi** que o PC.
- Se estiver em outra rede (ex.: 4G), n√£o funcionar√°.

#### Passo 6 ‚Äî Testar a conex√£o
No navegador do celular, acesse:
```
http://192.168.1.42:5000/health
```
Se aparecer resposta (ex: `{"status": "ok"}`), significa que o backend est√° acess√≠vel.

#### ‚ö†Ô∏è Observa√ß√£o Importante: Transfer√™ncia do APK
Ap√≥s compilar o projeto no **VS Code** ou Android Studio, o APK gerado precisa ser **transferido manualmente para o celular f√≠sico** (via cabo USB, e-mail, Google Drive, etc.) e instalado. Somente depois disso o app conseguir√° se comunicar com o backend via IP local.

---

Encoding recomendado do arquivo MANUAL_DE_RODAGEM.txt: UTF-8.

Fim do MANUAL_DE_RODAGEM.
